<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Spare Parts Management</title>

<style>
    body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background: #f4f2ff;
        color: #333;
    }

    /* Header */
    header {
        display: flex;
        align-items: center;
        padding: 16px;
        background: #6A0DAD;
        color: #fff;
        font-size: 20px;
        font-weight: 600;
    }
    header .back {
        margin-right: 10px;
        cursor: pointer;
        font-size: 22px;
    }

    /* Toolbar */
    .toolbar {
        display: flex;
        justify-content: space-between;
        padding: 16px;
        background: #fff;
        border-bottom: 1px solid #eee;
    }

    .toolbar input {
        width: 200px;
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .toolbar button {
        padding: 8px 14px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        background: #6A0DAD;
        color: #fff;
        margin-left: 5px;
    }

    /* Filter Panel */
    #filterPanel {
        display: none;
        background: #fff;
        padding: 12px;
        width: 240px;
        position: absolute;
        right: 16px;
        top: 90px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    #filterPanel select, #filterPanel button {
        width: 100%;
        margin-top: 10px;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    #filterPanel .close {
        text-align: right;
        cursor: pointer;
        font-size: 18px;
    }

    /* Table container */
    .card {
        margin: 30px;
        background: #fff;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }
    th {
        padding: 16px;
        background: #fff;
        text-transform: uppercase;
        text-align: left;
        font-weight: bold;
    }
    td {
        padding: 14px;
    }

    tr:nth-child(odd) { background: #F7F6FE; }
    tr:nth-child(even) { background: #fff; }

    .status-active {
        color: #0A8A3A;
        background: #E8F5E9;
        padding: 4px 10px;
        border-radius: 20px;
    }

    .status-inactive {
        color: #C62828;
        background: #FFEBEE;
        padding: 4px 10px;
        border-radius: 20px;
    }

    /* Pagination */
    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
        align-items: center;
        gap: 10px;
    }

    .pagination button, .pagination select {
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #ccc;
        cursor: pointer;
    }
</style>
</head>

<body>

<header>
    <span class="back">←</span>
    Spare Parts Management
</header>

<!-- Toolbar -->
<div class="toolbar">
    <div>
        <input id="searchInput" type="text" placeholder="Search parts...">
    </div>

    <div>
        <button id="filterBtn">Filter</button>
        <button id="addBtn">+ Add</button>
    </div>
</div>

<!-- Filter Dropdown -->
<div id="filterPanel">
    <div class="close" onclick="toggleFilter(false)">✖</div>

    <label>Seller Name</label>
    <select id="sellerFilter">
        <option value="All">All</option>
    </select>

    <button onclick="resetFilters()">Reset</button>
</div>

<!-- Table -->
<div class="card">
    <table>
        <thead>
            <tr>
                <th>Part Name</th>
                <th>Part Code</th>
                <th>Description</th>
                <th>Price</th>
                <th>Qty</th>
                <th>Seller</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination">
        <button id="prevBtn">← Prev</button>

        <span id="pageText"></span>

        <button id="nextBtn">Next →</button>

        <select id="rowsPerPage">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="30">30</option>
        </select>
    </div>
</div>

<script>
/* --------------------------
   SEED DATA - RUNS ONLY ONCE
---------------------------*/
if (!localStorage.spareParts) {
    localStorage.spareParts = JSON.stringify([
        {
            _id: "P001",
            name: "Brake Pad",
            code: "BRK-1001",
            desc: "High quality pad",
            price: 120.50,
            qty: 10,
            seller: "Alpha Traders",
            active: true
        },
        {
            _id: "P002",
            name: "Oil Filter",
            code: "OIL-2002",
            desc: "Premium oil filter",
            price: 35.00,
            qty: 25,
            seller: "Beta Supplies",
            active: false
        }
    ]);
}

/* GLOBAL STATE */
let data = JSON.parse(localStorage.spareParts);
let filtered = [...data];
let currentPage = 1;
let rows = 10;

/* DOM */
const tableBody = document.getElementById("tableBody");
const searchInput = document.getElementById("searchInput");
const sellerFilter = document.getElementById("sellerFilter");
const filterPanel = document.getElementById("filterPanel");
const pageText = document.getElementById("pageText");

/* Load sellers into dropdown */
function initSellerFilter() {
    const sellers = [...new Set(data.map(x => x.seller))];
    sellers.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s;
        opt.textContent = s;
        sellerFilter.appendChild(opt);
    });
}

/* Render table */
function renderTable() {
    let start = (currentPage - 1) * rows;
    let end = start + rows;
    let pageData = filtered.slice(start, end);

    tableBody.innerHTML = "";

    pageData.forEach(p => {
        tableBody.innerHTML += `
            <tr>
                <td>${p.name}</td>
                <td>${p.code}</td>
                <td>${p.desc}</td>
                <td style="text-align:right">AED ${p.price.toFixed(2)}</td>
                <td style="text-align:right">${p.qty}</td>
                <td>${p.seller}</td>
                <td>
                    <span class="${p.active ? "status-active" : "status-inactive"}">
                        ${p.active ? "Active" : "Inactive"}
                    </span>
                </td>
                <td>
                    <span style="color:#1e40ff;cursor:pointer">✎</span>
                </td>
            </tr>
        `;
    });

    pageText.textContent = `Page ${currentPage} of ${Math.ceil(filtered.length / rows)}`;
}

/* Search */
searchInput.addEventListener("input", () => {
    const q = searchInput.value.toLowerCase();

    filtered = data.filter(p =>
        p.name.toLowerCase().includes(q) ||
        p.code.toLowerCase().includes(q) ||
        p.desc.toLowerCase().includes(q)
    );

    currentPage = 1;
    renderTable();
});

/* Filter */
function applyFilters() {
    const seller = sellerFilter.value;

    filtered = data.filter(p => {
        let s = (seller === "All" || p.seller === seller);
        return s;
    });

    currentPage = 1;
    renderTable();
}

sellerFilter.addEventListener("change", applyFilters);

/* Reset */
function resetFilters() {
    sellerFilter.value = "All";
    filtered = [...data];
    currentPage = 1;
    renderTable();
}

/* Filter panel toggle */
function toggleFilter(show=true) {
    filterPanel.style.display = show ? "block" : "none";
}
document.getElementById("filterBtn").onclick = () => toggleFilter(true);

/* Pagination */
document.getElementById("prevBtn").onclick = () => {
    if (currentPage > 1) currentPage--;
    renderTable();
};
document.getElementById("nextBtn").onclick = () => {
    if (currentPage < Math.ceil(filtered.length / rows)) currentPage++;
    renderTable();
};
document.getElementById("rowsPerPage").onchange = (e) => {
    rows = Number(e.target.value);
    currentPage = 1;
    renderTable();
};

/* Init */
initSellerFilter();
renderTable();
</script>

</body>
</html>